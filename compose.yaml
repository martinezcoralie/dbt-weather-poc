services:
  weather-app:
    image: dbt-weather-poc/weather-app:latest  # nom/tag explicite pour l'image
    build: .                       # construit l’image depuis le Dockerfile à la racine
    volumes:
      - weather-data:/app/data     # volume nommé : seedé par l'image au premier run, persistant ensuite
    develop:
      watch:
        - action: sync             # synchro code hôte -> conteneur (hot-reload Streamlit, pas de rebuild)
          path: .
          target: /app
        - action: rebuild          # rebuild si les deps changent
          path: requirements.txt
        - action: rebuild          # rebuild si l’image change
          path: Dockerfile
    env_file:
      - .env                       # injecte les variables d’environnement depuis le fichier .env
    ports:
      - "8501:8501"                # expose le port 8501 du conteneur sur 8501 de l’hôte (Streamlit)

volumes:
  weather-data:
