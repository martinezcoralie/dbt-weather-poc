version: 2

models:
  - name: stg_obs_hourly
    description: >
      Observations horaires issues du flux Météo-France.  
      Types corrigés, timestamps normalisés en UTC, et valeurs bornées pour cohérence.
    columns:
      - name: station_id
        description: Identifiant de la station (référence à stg_stations).
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_stations')
                field: station_id

      - name: production_time_utc
        description: Heure de production du bulletin (UTC).
        tests: [not_null]

      - name: validity_time_utc
        description: Heure de validité de la mesure (UTC).
        tests: [not_null]

      - name: latitude
        description: Latitude du poste de mesure (-90 à 90).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "between -90 and 90"

      - name: longitude
        description: Longitude du poste de mesure (-180 à 180).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "between -180 and 180"

      - name: humidity_pct
        description: Humidité relative (%) bornée 0–100.
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is null or humidity_pct between 0 and 100"

      - name: wind_dir_deg
        description: Direction moyenne du vent (0–360°).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is null or wind_dir_deg between 0 and 360"

      - name: pressure_station_pa
        description: Pression au niveau de la station (Pa).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is null or pressure_station_pa between 80000 and 110000"

      - name: pressure_sea_pa
        description: Pression ramenée au niveau de la mer (Pa).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is null or pressure_sea_pa between 80000 and 110000"

      - name: visibility_m
        description: Portée visuelle horizontale (m).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is null or visibility_m >= 0"

      - name: snow_depth_m
        description: Hauteur de neige au sol (m).
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: "is null or snow_depth_m >= 0"
